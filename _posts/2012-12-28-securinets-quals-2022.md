---
title: Securinets Quals 2022
categories:
- Securinets CTF
excerpt: |
  
---

Challenge files [here](https://github.com/Connor-McCartney/CTF-files/tree/main/securinets-quals-2022/Escrime).
	
### Escrime

```python
from math import gcd
from Crypto.Util.number import *

n1 = 5285941989924581490741575774796326221790301948671605967204654261159288826022690654909746856601734294076351436205238123432817696904524845143908229601315593896823359605609172777227518764838488130850768836467030938547486936412484230693105639039311878853055295612388722273133638524917106191321503530749409311343663516633298043891444321772817485480644504762143353706512690041092791539952154332856635651319630479019844011333570438615137628705917690349203588170944935681
n2 = 5512656145670579765357132887430527554149315293720001536465226567777071834432904027590899542293511871806792894769506962601330354553170015126601443256295513753986998761021594415121386822360537570074896704547101502955980189351257681515387379761554807684880212096397524725819607628411147885452294832392886405475830663300445429053365129797792206619514994944481130684176571005780217091773969415001961227566026934419626425934895777818074251010427154279687683891897394401
e = 65537
c1 = 3792561290017712418676552700903779226679678307521013229152018077539055935181708693237786486418411190513573593312739874489485768872374239333562352570689090751306553033406629945001093355613620844532659507519582518955178617942044813600181673015763469247380587771641089223066734168709065596269187564842646397647564064090886856491267151338586218098150720579275673440512159074650632829004798635425409766385176472514086448897744502264325566940224093583630788193949908215
c2 = 3222093169881176821995152873609430742364413196826316856495679228145853706169389758246323802005549827444022148276365869623395771621464376723299960525487777645386674088866891887984766934440527885549168365996216682223515034398685244541695223412679979637178695229351272286453267599205874775267533781360269542834699741976380260822746797186755978820611721151719635986648586937891954519919600047846994285652165076540057377973800029963140392459328016771048953153246246886
"""
let prime = x 
we have:
n1 = p1 * q1 = (2ax + 1)(2bx + 1) 
(n1-1)/2 = x(2abx + a + b)

and similarly 
(n2-1)/2 = x(2cdx + c + d)

thus x|(n1//2) and x|(n2//2)
"""
print(n1//2)
print(n2//2)
"""
now I put both of these into factordb.com
each has a few small prime factors and one large factor (not prime)
gcd of these gives x
"""
f1 = 125140672109956948170965335577564541235565860527263398844807155803960436222128093156007264597578936886277259379858857088845115930504849553596312253819024476724037869450974734309363607122123298552338277378480846083037096032492524400878447893923103192543922718096323917451080457502772400362724988890847758317795064314235275660308814435909504864598591495315893790400395124078901314866291532501340806139195797325280397995586421368729584012924187745009554644198507
f2 = 854115439731436112847129169933940445903732919172742950176786473276675110276576918972784162038268219162055562895213839732053572257654166813245202719495052593605425280842064477078212285324175007995922703797883645857952896082570951761427114253603127741947743567124687695550620943494819046398904010413398119402129070247724807499879355669267787022196713785877206452847749313067526260625978452215637487782338315961382272766386630325434941300026702058033
x = gcd(f1, f2)
assert isPrime(x)
"""
now we have
n1//2//x = 2abx + a + b

divide everything by 2x:
n1//(2x*2x) = ab + a/2x + b/2x
and a/2x and b/2x are small fractions, so can ignore and we have ab
"""
ab = n1//(2*x*2*x)
"""
this is still too large to factorise, but we can do
(a+b) = n1//(2*x) - 2*x*ab
"""
a_plus_b = n1//(2*x) - 2*x*ab
"""
now we can solve using simultaneous equations 
and we get a quadratic
let y = ab
let z = a_plus_b

a = z-b
y = b(z-b)
b*b - bz + y = 0
quadratic formula:
b = (z +- sqrt(z*z - 4y)) / 2
"""
from math import isqrt
y = ab
z = a_plus_b
b = (z + isqrt(z*z - 4*y)) // 2
a = z - b
assert a*b == ab

#now do same for c and d
y = n2//(2*x*2*x)
z = n2//(2*x) - 2*x*y
c = (z + isqrt(z*z - 4*y)) // 2
d = z - c

#now we can calculate p and q
p1 = 2*a*x + 1
q1 = 2*b*x + 1
p2 = 2*c*x + 1
q2 = 2*d*x + 1

d1 = pow(e, -1, (p1-1)*(q1-1))
d2 = pow(e, -1, (p2-1)*(q2-1))

m1 = pow(c1, d1, n1)
m2 = pow(c2, d2, n2)

print(long_to_bytes(m1).decode(), end="")
print(long_to_bytes(m2).decode())
#Securinets{G3n3r4t1ng_pr1m3s_1n_4_sp3c1f1c_f0rm_4lm0st_4lw4ys_3nds_b4dly}
```
