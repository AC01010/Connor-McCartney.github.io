---
title: RSA - Public Exponent
categories:
- CryptoHack
excerpt: |
  
---

This is my writeup of the [CryptoHack RSA challenges](https://cryptohack.org/challenges/rsa).


### Salty

This challenge is vulnerable to a small exponent attack. This occurs when m<sup>e</sup> is less than n. To decrypt using this attack, m = the eth root of the ciphertext.
Here e=1, so m is simply c. 
```python
from Crypto.Util.number import bytes_to_long, long_to_bytes #pip install pycryptodome

c = 44981230718212183604274785925793145442655465025264554046028251311164494127485
print(long_to_bytes(c).decode())
```
This gives crypto{saltstack_fell_for_this!}

### Modulus Inutilis

We can use small exponent attack again. 
```python
from Crypto.Util.number import long_to_bytes #pip install pycryptodome

c = 243251053617903760309941844835411292373350655973075480264001352919865180151222189820473358411037759381328642957324889519192337152355302808400638052620580409813222660643570085177957

def nth_root(x,n):
    high = 1
    while high ** n <= x:
        high *= 2
    low = high // 2
    while low < high:
        mid = int((low + high) // 2) + 1
        if low < mid and mid ** n < x:
            low = mid
        elif high > mid and mid ** n > x:
            high = mid
        else:
            return mid
    return mid + 1

print(long_to_bytes(nth_root(c, 3)).decode())
```
This gives crypto{N33d_m04R_p4dd1ng}

### Everything is Big

For large e, d *might* be small, allowing [Wiener's attack](https://en.wikipedia.org/wiki/Wiener%27s_attack).
```python
import owiener #pip3 install owiener
from Crypto.Util.number import long_to_bytes

n = 0x8da7d2ec7bf9b322a539afb9962d4d2ebeb3e3d449d709b80a51dc680a14c87ffa863edfc7b5a2a542a0fa610febe2d967b58ae714c46a6eccb44cd5c90d1cf5e271224aa3367e5a13305f2744e2e56059b17bf520c95d521d34fdad3b0c12e7821a3169aa900c711e6923ca1a26c71fc5ac8a9ff8c878164e2434c724b68b508a030f86211c1307b6f90c0cd489a27fdc5e6190f6193447e0441a49edde165cf6074994ea260a21ea1fc7e2dfb038df437f02b9ddb7b5244a9620c8eca858865e83bab3413135e76a54ee718f4e431c29d3cb6e353a75d74f831bed2cc7bdce553f25b617b3bdd9ef901e249e43545c91b0cd8798b27804d61926e317a2b745
e = 0x86d357db4e1b60a2e9f9f25e2db15204c820b6e8d8d04d29db168c890bc8a6c1e31b9316c9680174e128515a00256b775a1a8ccca9c6936f1b4c2298c03032cda4dd8eca1145828d31466bf56bfcf0c6a8b4a1b2fb27de7a57fae7430048d7590734b2f05b6443ad60d89606802409d2fa4c6767ad42bffae01a8ef1364418362e133fa7b2770af64a68ad50ad8d2bd5cebb99ceb13368fb31a6e7503e753f8638e21a96af1b6498c18578ba89b98d70fa482ad137d28fe701b4b77baa25d5e84c81b26ee9bddf8cbb51a071c60dd57714de379cd4bc14932809ba18524a0a18e4133665cfc46e2c4fcfbc28e0a0957e5513a7307c422b87a6182d0b6a074b4d
c = 0x6a2f2e401a54eeb5dab1e6d5d80e92a6ca189049e22844c825012b8f0578f95b269b19644c7c8af3d544840d380ed75fdf86844aa8976622fa0501eaec0e5a1a5ab09d3d1037e55501c4e270060470c9f4019ced6c4e67673843daf2fd71c64f3dd8939ae322f2b79d283b3382052d076ebe9bb50b0042f1f7dd7beadf0f5686926ade9fc8370283ead781a21896e7a878d99e77c3bb1f470401062c0e0327fd85da1cf12901635f1df310e8f8c7d87aff5a01dbbecd739cd8f36462060d0eb237af8d613e2d9cebb67d612bcfc353ef2cd44b7ac85e471287eb04ae9b388b66ea8eb32429ae96dba5da8206894fa8c58a7440a127fceb5717a2eaa3c29f25f7
d = owiener.attack(e, n)
m = pow(c, d, n)
print(long_to_bytes(m).decode())
```
This gives crypto{s0m3th1ng5_c4n_b3_t00_b1g}.

### Crossed Wires

This challenge involved a lot of modular arithmetic. <br>
We are given the ciphertext c, exponent e = 65537, n and d from our private key, and exponents e<sub>1</sub>, e<sub>2</sub>, e<sub>3</sub>, e<sub>4</sub>, e<sub>5</sub> from the friend's public keys. The modulus n is the same for all private and public keys. <br>
The message m is encrypted with all of the friend's public keys: <br>
c = ((((m<sup>e1</sup> mod n)<sup>e2</sup> mod n)<sup>e3</sup> mod n)<sup>e4</sup> mod n)<sup>e5</sup> mod n 

Each exponent from the friend's public key must be decrypted with a corresponding d. <br>
m = ((((c<sup>d5</sup> mod n)<sup>d4</sup> mod n)<sup>d3</sup> mod n)<sup>d2</sup> mod n)<sup>d1</sup> mod n 

Since (x<sup>a</sup> mod n)<sup>b</sup> mod n = x<sup>ab</sup> mod n, this simplifies to:  <br>
m = c<sup>d1 x d2 x d3 x d4 x d5</sup> mod n

Next we must solve for d1 x d2 x d3 x d4 x d5. Note I'll refer to phi(n) as just phi. <br>
e1 * d1 = 1 mod phi <br>

So long as k < e1, we can use the fact that: <br>
e1(e1<sup>-1</sup> mod (k * phi)) = 1 mod phi

Thus, <br>
d1 = e1<sup>-1</sup> mod (k * phi)
                           
We know in RSA that ed = 1 mod phi. From this we can get k x phi = ed - 1. Now we substitute this:<br>
d1 = e1<sup>-1</sup> mod (ed - 1)

We can repeat this for d2, d3, d4 and d5.

d1 x d2 x d3 x d4 x d5 = (e1<sup>-1</sup> mod (ed - 1))(e2<sup>-1</sup> mod (ed - 1))(e3<sup>-1</sup> mod (ed - 1))(e4<sup>-1</sup> mod (ed - 1))(e5<sup>-1</sup> mod (ed - 1))<br>d1 x d2 x d3 x d4 x d5 = (e1 x e2 x e3 x e4 x e5)<sup>-1</sup> mod (ed - 1)
       
If we sub this in we get:
m = c<sup>(e1 x e2 x e3 x e4 x e5)<sup>-1</sup> mod (ed - 1)</sup> mod n
       
We can calculate this in python:
```python
from Crypto.Util.number import long_to_bytes

e = 65537
c = int("""20304610279578186738172766224224793119885071262464464448863461184092225736054747976985179673905441502689126216282897704508745403799054734121583968853999791604281615154100
7362591314534243853643246302296711853437781728072626407093018382748246031016924856627262269021211055911374373314632018812642455622140121608751771674420109524393606233966589744139004
6909383679475227039952007459632905872587483408218869737759794940577903913919419606536442621320834546140703077108978752920005710574658449355472279059253047286958131011730034346120775
0821737840042745530876391793484035024644475535353227851321505537398888106855012746117""".replace("\n", ""))
n = int("""21711308225346315542706844618441565741046498277716979943478360598053144971379956916575370343448988601905854572029635846626259487297950305231661109855854947494209135205589
2586435179615215949243684986720642932082308024410773901936829580951119220826778131758047756288843777243776474283858418312770592741729822805452377655599692287075068575612152684910240
9706392033772178367306053018163716157740158912655855618254689678330737051727504652270404738578611148944706479421001080276170861590724552349258589628637499608808931782616279827852829
6206977900274431829829206103227171839270887476436899494428371323874689055690729986771""".replace("\n", ""))
d = int("""27344116772511480307231380057161097338388665453755276020182551593196310266531907836704931079364016039814291718805043605604947710172464687029026473709542203124525413428587
4759057627377510787045085353371711668432697626300643573338204580797189076201874772957402105743033177803398235918483815974733123653850184996532926477492760757041034701941840745193787
5684373454982306923178403161216817237890962651214718831954215200637651103907209347900857824722653217179548148145687181377220544864521808230122730967452981435355334932104265488075777
638608041325256776275200067541533022527964743478554948792578057708522350812154888097""".replace("\n", ""))

m = pow(c, pow(106979 * 108533 * 69557 * 97117 * 103231, -1, e*d-1) , n)
print(long_to_bytes(m).decode())
```

This gives crypto{3ncrypt_y0ur_s3cr3t_w1th_y0ur_fr1end5_publ1c_k3y}.

### Everything is Still Big

Boneh Durfee attack can be used when the private exponent d is too small compared to the modulus.<br>
I used modified [this implementation](https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage) and got d in under a second. 

```python
def boneh_durfee(pol, modulus, mm, tt, XX, YY):
    PR.<u, x, y> = PolynomialRing(ZZ)
    Q = PR.quotient(x*y + 1 - u)
    polZ = Q(pol).lift()
    UU = XX*YY + 1
    gg = []
    for kk in range(mm + 1):
        for ii in range(mm - kk + 1):
            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk
            gg.append(xshift)
    gg.sort()
    monomials = []
    for polynomial in gg:
        for monomial in polynomial.monomials():
            if monomial not in monomials:
                monomials.append(monomial)
    monomials.sort()
    
    for jj in range(1, tt + 1):
        for kk in range(floor(mm/tt) * jj, mm + 1):
            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)
            yshift = Q(yshift).lift()
            gg.append(yshift)
    
    for jj in range(1, tt + 1):
        for kk in range(floor(mm/tt) * jj, mm + 1):
            monomials.append(u^kk * y^jj)

    nn = len(monomials)
    BB = Matrix(ZZ, nn)
    for ii in range(nn):
        BB[ii, 0] = gg[ii](0, 0, 0)
        for jj in range(1, ii + 1):
            if monomials[jj] in gg[ii].monomials():
                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)
    BB = BB.LLL()

    for pol1_idx in range(nn - 1):
        for pol2_idx in range(pol1_idx + 1, nn):
            PR.<w,z> = PolynomialRing(ZZ)
            pol1 = pol2 = 0
            for jj in range(nn):
                pol1 += monomials[jj](w*z+1,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)
                pol2 += monomials[jj](w*z+1,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)
            PR.<q> = PolynomialRing(ZZ)
            rr = pol1.resultant(pol2)
            if rr.is_zero() or rr.monomials() == [1]:
                continue
            else:
                found_polynomials = True
                break
        if found_polynomials:
            break
    rr = rr(q, q)
    soly = rr.roots()
    soly = soly[0][0]
    solx = pol1(q, soly).roots()[0][0]
    return solx, soly


def main():
    ###############################INPUTS#################################
    N = 0x665166804cd78e8197073f65f58bca14e019982245fcc7cad74535e948a4e0258b2e919bf3720968a00e5240c5e1d6b8831d8fec300d969fccec6cce11dde826d3fbe0837194f2dc64194c78379440671563c6c75267f0286d779e6d91d3e9037c642a860a894d8c45b7ed564d341501cedf260d3019234f2964ccc6c56b6de8a4f66667e9672a03f6c29d95100cdf5cb363d66f2131823a953621680300ab3a2eb51c12999b6d4249dde499055584925399f3a8c7a4a5a21f095878e80bbc772f785d2cbf70a87c6b854eb566e1e1beb7d4ac6eb46023b3dc7fdf34529a40f5fc5797f9c15c54ed4cb018c072168e9c30ca3602e00ea4047d2e5686c6eb37b9
    e = 0x2c998e57bc651fe4807443dbb3e794711ca22b473d7792a64b7a326538dc528a17c79c72e425bf29937e47b2d6f6330ee5c13bfd8564b50e49132d47befd0ee2e85f4bfe2c9452d62ef838d487c099b3d7c80f14e362b3d97ca4774f1e4e851d38a4a834b077ded3d40cd20ddc45d57581beaa7b4d299da9dec8a1f361c808637238fa368e07c7d08f5654c7b2f8a90d47857e9b9c0a81a46769f6307d5a4442707afb017959d9a681fa1dc8d97565e55f02df34b04a3d0a0bf98b7798d7084db4b3f6696fa139f83ada3dc70d0b4c57bf49f530dec938096071f9c4498fdef9641dfbfe516c985b27d1748cc6ce1a4beb1381fb165a3d14f61032e0f76f095d
    c = 0x503d5dd3bf3d76918b868c0789c81b4a384184ddadef81142eabdcb78656632e54c9cb22ac2c41178607aa41adebdf89cd24ec1876365994f54f2b8fc492636b59382eb5094c46b5818cf8d9b42aed7e8051d7ca1537202d20ef945876e94f502e048ad71c7ad89200341f8071dc73c2cc1c7688494cad0110fca4854ee6a1ba999005a650062a5d55063693e8b018b08c4591946a3fc961dae2ba0c046f0848fbe5206d56767aae8812d55ee9decc1587cf5905887846cd3ecc6fc069e40d36b29ee48229c0c79eceab9a95b11d15421b8585a2576a63b9f09c56a4ca1729680410da237ac5b05850604e2af1f4ede9cf3928cbb3193a159e64482928b585ac
    ###############################INPUTS#################################

    # attack
    m = 4 # size of the lattice (bigger the better/slower)
    delta = .18
    t = int((1-2*delta) * m)
    X = 2*floor(N^delta)
    Y = floor(N^(1/2))
    P.<x,y> = PolynomialRing(ZZ)
    A = int((N+1)/2)
    pol = 1 + x * (A + y)
    solx, soly = boneh_durfee(pol, e, m, t, X, Y)
    if solx > 0:
        d = int(pol(solx, soly) / e)
        print("d found:", d)

    flag = int(pow(c, d, N))
    print(flag.to_bytes((flag.bit_length() + 7) // 8, 'big').decode())

if __name__ == "__main__":
    main()
```
This gives crypto{bon3h5_4tt4ck_i5_sr0ng3r_th4n_w13n3r5}.

### Endless Emails

We can use [Hadstad's Broadcast Attack](https://en.wikipedia.org/wiki/Coppersmith's_attack#H%C3%A5stad's_broadcast_attack) to solve this challenge. 

```python
from Crypto.Util.number import long_to_bytes
from sympy import cbrt
from itertools import combinations

def nth_root(x,n):
    high = 1
    while high ** n <= x:
        high *= 2
    low = high // 2
    while low < high:
        mid = int((low + high) // 2) + 1
        if low < mid and mid ** n < x:
            low = mid
        elif high > mid and mid ** n > x:
            high = mid
        else:
            return mid
    return mid + 1

n1 = int("""14528915758150659907677315938876872514853653132820394367681510019000469589767908107293777996420037715293478868775354645306536953789897501630398061779084810058931494642860
72979905932505184033144991452959411359383554949320824633343794555163998305681085543539644497824909341929065184776407360760779404507638664302330645871817157498918521368426362833638526
88182020548113788102166234406440768464649027985687050832826195131918550873990107602321124344122747010340944299542313664229689913222443430384586812550353569849003845091588580077130474
28143658924970374944616430311056440919114824023838380098825914755712289724493770021""".replace("\n", "")) 
n2 = int("""20463913454649855046677206889944639231694511458416906994298079596685813354570085475890888433776403011296145408951323816323011550738170573801417972453504044678801608709931
20005996715760541680938775325825191478876120245683094094448691529262656051525080501722987656591634996392370261258448487511369105771631546623906200520601454208848438738972505807091711
85496215986299648195964125640946270307477206591555586901240054002576858832308810156360661837435164947019001257888368693586340310311725367679509438584722575191953929869892324776307946
00444813136409000056443035171453870906346401936687214432176829528484662373633624123""".replace("\n", ""))
n3 = int("""19402640770593345339726386104915705450969517850985511418263141255686982818547710008822417349818201858549321868878490314025136645036980129976820137486252202687238348587398
33665295543518209072284466848884298631821164956959308944478159515904537232254013125020825809361384475302127238925506939855352384897553056398936708289640471954441194686459452770805888
74755950560337133618938083303416238043677857217742710843891594939749463203595127763289844871265830157779899916354287440508686533791918429983457212602169539182032481670790724429487320
00084754225272238189439501737066178901505257566388862947536332343196537495085729147""".replace("\n", ""))
n4 = int("""12005639978012754274325188681720834222130605634919280945697102906256738419912110187245315232437501890545637047506165123606573171374281507075652554737014979927883759915891
86364622120583521164084571483692737384427787856266654523087664083014163737172940554550992088996804626813580999911785696869223674280463792986663290832952208797707784904560856691165423
45415266432355864330651703929201028405181928038547403984783055980921971836712921547431531300128857472432193727096698798630987083189938440055669844916227617953494554049522859371524231
45150066181043576492305166964448141091092142224906843816547235826717179687198833961""".replace("\n", ""))
n5 = int("""17795451956221451086587651307408104001363221003775928432650752466563818944480119932209305765249625841644339021308118433529490162294175590972336954199870002456682453215153
11118245152664305581231107158838240954904594380686917332305805990867802255810104163027265859229132738754900162162575758507966287350199018225036890930204001551845406869926791413767564
46955237528512291488870527748457776992877183429165301220314952671227009125182075718213671230131641251091743994861587176048511252443565863699211446409692624272208289406529942760842251
96272504355264547588369516271460361233556643313911651916709471353368924621122725823""".replace("\n", ""))
n6 = int("""25252721057733555082592677470459355315816761410478159901637469821096129654501579313856822193168570733800370301193041607236223065376987811309968760580864569059669890823406
08431384167888803110346197288834694216073103963732622471690194094357144521782796035363782552386232413320309484322806807746298394189957173615322776482212233483843687548828916265910065
29562524273784760041646986566623338929633481269317715364726744479322682822055452299077158931393469418323678853195971984741808880876584418803466815949278815171504256101455189425452937
50127300041942766820911120196262215703079164895767115681864075574707999253396530263""".replace("\n", ""))
n7 = int("""19833203629283018227011925157509157967003736370320129764863076831617271290326613531892600790037451229326924414757856123643351635022817441101879725227161178559229328259469
47296166585765069341321508749344837286083780661985018873461982958028654129299772970590989973895122855583477327367651514355009171000413973408072739212140577291151074602580707063510224
91546154545050803769207787033601782959015523236111201847374295136691676418469025982816214086298834870791101722187358074772755903671108612557562895201147198600003472191619440200670993
98239199863252349401303744451903546571864062825485984573414652422054433066179558897""".replace("\n", ""))
N = [n1,n2,n3,n4,n5,n6,n7]

c1 = int("""69658916129878617269750669773772539618371396912207638213700365763506055764857063307141928373363314936532833052411938835934109881322457915542838747858718492232911345713660
93850082919285063130119121338290718389659761443563666214229749009468327825320914097376664888912663806925746474243439550004354390822079954583102082178617110721589392875875474288168921
40355041553170741993104058301952961227048248271803549755477973357841105763352497187039989385158934547630769579956791955042641701581545514186370383514222330022823054725552381509743142
0381177861163863791690147876158039619438793849367921927840731088518955045807722225""".replace("\n", ""))
c2 = int("""51093636050896188161201783193611711155901713520485060216505396395213566669863087210628431329051702610257728509417020856838553366534729491460127001160700225319264766254675
38166881085235022484711752960666438445574269179358850309578627747024264968893862296953506803423930414569834210215223172069261612934281834174103316403670168299182121939323001232617718
32797731365929075531897260395857900030078068534472830150364158380664822741678189853836797198356223677057617430896592927526792937993436773669411068456957657526634802080072353512163817
5505282145714117112442582416208209171027273743686645470434557028336357172288865172""".replace("\n", ""))
c3 = int("""56033863964582283142309755007608339913838666385042164007660442001735761793234370581015629314305587381488523672928029187252716328458897287113166886810807627623243672733327
64959495900563756768440309595248691744845766607436966468714038018108912467618638117493367675937079141350328486149333053000366933205635396038539236203203489974033629281145427277222568
98946999417808435746016031059826036503005663122234669152786169611633494620107452941798462430497374765340731729066422450748568442199952716412239567446965015585186965107284730313662193
2989550786722041915603539800197077294166881952724017065404825258494318993054344153""".replace("\n", ""))
c4 = int("""15222807413830247749332801984105258468334109314170644792781610882486213903057972102857778453598127159093425958047427101528321683654339057186294655453060282754986679359291
80318276445229415104842407145880223983428713335709038026249381363564625791656631137936935477777236936508600353416079028339774876425198789629900265348122040413865209592074731028757972
96863560169546859412352389291874788222189183459889648339371185151047998920364447797269452023726227153026049634224735576199264682705784610918141046213187537740430998307235831396042703
5348425800940661373272947647516867525052504539561289941374722179778872627956360577""".replace("\n", ""))
c5 = int("""87525078061254800636470817495069664280260054643255357658745893765724311018160844984820640838874006464389774372737000049342572745161971484484254552438110099443217647713920
44345410680448204581679548854193081394891841223548418812679441816502910830861271884276608891963388657558218620911858230760629700918375750796354647493524576614017731938584618983084762
61241459183002411305798348315697409550339235994672275636441239918791060402958346452161725612593311178644185276522982040691199180903951901543479365671019915338069931961149925586904531
1421603167606551250174746275803467549814529124250122560661739949229005127507540805""".replace("\n", ""))
c6 = int("""23399624135645767243362438536844425089018405258626828336566973656156553220156563508607371562416462491581383453279478716239823054532476006642583363934314982675152824147243
74971583079448826884667167028761732452274012659414815994513794864359798168152914561146353410948220952044864062210371868232315803979757738725426585421872747692816407424956803149398482
52733829591470788396651144178964637356355462905048439577805465505773000014527477609824685477564271372848301333050100383394002304774038368566638839564638305719346572008515989861741773
86323915542033293658596818231793744261192870485152396793393026198817787033127061749""".replace("\n", ""))
c7 = int("""15239683995712538665992887055453717247160229941400011601942125542239446512492703769284448009141905335544729440961349343533346436084176947090230267995060908954209742736573
98631925469557026533946948994810256207298399666836186428644460253466628433946679747780537210972317884178819817733764849989907947122192427659004218338218232651831297910937861630636436
36305196778848499456062888816836259443659278094054205405258671736392226960274723369818385882567716719102175531505888784340618628408930457634564579399445721928489923331154799511106220
66173007227047527992906364658618631373790704267650950755276227747600169403361509144""".replace("\n", ""))
C = [c1,c2,c3,c4,c5,c6,c7]

for i in list(combinations([i for i in range(7)],3)):
	n1 = N[i[0]]
	n2 = N[i[1]]
	n3 = N[i[2]]
	c1 = C[i[0]]
	c2 = C[i[1]]
	c3 = C[i[2]]

	m = long_to_bytes(nth_root((c1*pow(n1*n2*n3//n1,-1,n1)*n1*n2*n3//n1+c2*pow(n1*n2*n3//n2,-1,n2)*n1*n2*n3//n2+c3*pow(n1*n2*n3//n3,-1,n3)*n1*n2*n3//n3)%(n1*n2*n3),3))
	if b'crypto' in m:
		print(m.decode())
		break
```

This gives crypto{1f_y0u_d0nt_p4d_y0u_4r3_Vuln3rabl3}.
